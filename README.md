Презентация 5 различный конфигураций для веб-сервера nginx.

nginx.conf является главным файлом конфигурации для nginx к которому будут подключаться нужные конфигурационные файлы при помощи дерективы include.

--------------------------------------------------------------
static_site.conf настраивает nginx на отдачу статичных файлов сайта.

Корневая директория с файлами отдаваемого сайта выбирается при помощи директивы root

директива location / обрабатывает соединения на корень сайта

директива try_files при отсутствии отдаваемых файлов будет будет перенаправлять клиента по вписанным переменным
----------------------------------------------------------------
ssl_site.conf 

при попытке пользователя зайти на сайт через http://{site} без ssl сертификата перенаправит его на https:// этого же домена для ssl-handshake

----------------------------------------------------------------
reverse_proxy.conf 

Пробрасывает соединение через директиву proxy_pass
Директива proxy_set_header устанавливает заголовки полученные веб-сервером для передачи проксируемому серверу ( например для логов )

-----------------------------------------------------------------

rate_limit.conf

Хранит IP каждого клиента в бинарном виде и ограничивает запросы к API до 5 r/s.
При превышении лимита доступен буфер всплесков (burst) до +10 запросов сверх нормы.

Без параметра nodelay burst-запросы ставятся в очередь и обрабатываются медленно — в соответствии с rate (5 r/s).
С nodelay burst-запросы не ставятся в очередь и обрабатываются немедленно.

-------------------------------------------------------------------

logging.conf

Настраивает логирование входящих подключений к серверу.

log_format описывает вид будущих логов

open_log_file_cache говорит NGINX не открывать/закрывать файл лога на каждый запрос.
Этот кэш уменьшает нагрузку на диск и снижает количество системных вызовов.

access_log /var/log/nginx.log - путь для логов по умолчанию, если не указано иное.

В server_name используется регулярка 1$ www. 2$ сам домен

access_log /var/log/nginx/combined/combined.log vhost - путь для логов формата vhost

access_log /var/log/nginx/$2/access.log персональный лог для каждого домена

-------------------------------------------------------------------

balance.conf 

Распределяет нагрузку между серверами вписанными в upstream.
В данном примере используется механизм least_conn соединяющий клиента с сервером с наименьшим количеством подключений.
По умолчанию - round_robin




